#!/bin/zsh

###################################################################################################
# Script Name:  Collect-SPSSLog4JShellVulnerability.sh
# By:  Zack Thompson / Created:  3/25/2022
# Version:  1.0.0 / Updated:  3/25/2022 / By:  ZT
#
# Description:  This script checks if SPSS has unpatched log4j files.
#
###################################################################################################

patched_version="2.17.1"

echo "Searching for vulnerable SPSS instances..."

if [ -n "$( /usr/bin/find -E /Applications -iregex ".*[/](SPSS) ?(Statistics) ?([0-9]{2})?[.]app/Contents/.+/.*log4j.+\.jar" -not -iregex ".*[/](SPSS) ?(Statistics) ?([0-9]{2})?[.]app/Contents/.+/.*log4j.+(${patched_version})\.jar" -type f -prune )" ]; then

	echo "<result>Unpatched</result>"

else

	echo "<result>Not Vulnerable</result>"

fi

exit 0